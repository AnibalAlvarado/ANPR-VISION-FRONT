<h2 *ngIf="title" class="form-title">
  {{ title }}
</h2>
<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <ng-container *ngFor="let field of config">

    <!-- Campos de texto / número / teléfono -->
    <mat-form-field *ngIf="field.type === 'text' || field.type === 'tel' || field.type === 'number'"appearance="outline" style="width: 100%;">
      <mat-label>{{ field.label }}</mat-label>
      <input
        matInput
        [type]="field.type"
        [formControlName]="field.name"
        [required]="!!field.required">

      <!-- Itera sobre todas las validaciones del campo para mostrar los mensajes -->
      <!-- <mat-error *ngFor="let val of field.validations" 
                 [ngIf]="form.get(field.name)?.hasError(val.validator)">
        {{ val.message }}
      </mat-error> -->
        <mat-error *ngFor="let validation of field.validations" >
          <span *ngIf="form.get(field.name)?.hasError(validation.validator)" class="error-message">
            {{ validation.message }}
          </span>
        </mat-error>
    </mat-form-field>

    <!-- Textarea -->
    <mat-form-field *ngIf="field.type === 'textarea'" appearance="outline" style="width: 100%;">
      <mat-label>{{ field.label }}</mat-label>
      <textarea
        matInput
        [formControlName]="field.name"
        [required]="!!field.required"
        rows="4"></textarea>

      <!-- Itera sobre todas las validaciones del campo para mostrar los mensajes -->
      <!-- <mat-error *ngFor="let val of field.validations" 
                 [ngIf]="form.get(field.name)?.hasError(val.validator)">
        {{ val.message }}
      </mat-error> -->
      <mat-error *ngFor="let validation of field.validations"  >
        <span *ngIf="form.get(field.name)?.hasError(validation.validator)" class="error-message">
          {{ validation.message }}
        </span>
      </mat-error>
    </mat-form-field>

    <!-- Select (soporta multiple) -->
    <mat-form-field *ngIf="field.type === 'select'" appearance="outline" >
      <mat-label>{{ field.label }}</mat-label>
      <mat-select
        [formControlName]="field.name"
        [required]="!!field.required"
        [multiple]="!!field.multiple"
        [compareWith]="compareByValue">
        <mat-option *ngFor="let opt of field.options" [value]="opt.value">
          {{ opt.label }}
        </mat-option>
      </mat-select>

      <!-- Itera sobre todas las validaciones del campo para mostrar los mensajes -->
      <!-- <mat-error *ngFor="let val of field.validations"  
                 [ngIf]="form.get(field.name)?.hasError(val.validator)">
        {{ val.message }}
      </mat-error> -->
      <mat-error *ngFor="let validation of field.validations">
        <span *ngIf="form.get(field.name)?.hasError(validation.validator)" class="error-message">
          {{ validation.message }}
        </span>
      </mat-error>
    </mat-form-field>

    <!-- Toggle -->
    <mat-slide-toggle
      *ngIf="field.type === 'toggle' && !field.hidden"
      [formControlName]="field.name"
      color="primary">
      {{ field.label }}
    </mat-slide-toggle>

  </ng-container>

  <div style="margin-top: 1rem;">
    <button mat-raised-button color="primary" type="submit">
      {{ isEdit ? 'Actualizar' : 'Crear' }}
    </button>
    <button mat-button type="button" (click)="cancelForm.emit()">Cancelar</button>
  </div>
</form>